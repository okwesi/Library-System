{% extends 'base.html' %}
{% load static %}

{% block title %}Approve Books{% endblock title %}

{% block content %}
<h2>School Orders</h2>
{% for order in school_request %}
  
<p>{{order.school.name}}</p>
<p>{{order.book.title}}</p>
<p>{{order.status}}</p>
{% endfor %}


<h2>Students Orders</h2>

<table class="table table-success table-striped">
    <thead>
        <tr>
            <th scope="col">Student</th>
            <th scope="col">Book</th>
            <th scope="col">Status</th>
            <th scope="col">Date</th>
        </tr>
    </thead>
    <tbody>
        {% for student_request in student_requests%}
        <tr>
            <td>{{student_request.student.name}}</td>
            <td>{{student_request.book.title}}</td>
            <td>{{student_request.status}}</td>
            <td>{{student_request.request_date}}</td>
        </tr>
        {% endfor %}

    </tbody>
</table>

<form action="" method="post" id="approve-form">
    {% csrf_token %}
    <button type="submit">Approve Request</button>
</form>

<script>
    const form = document.getElementById("approve-form")
    var csrf_token = document.getElementsByName('csrfmiddlewaretoken')[0].value

    form.addEventListener('submit', e => {
        e.preventDefault()
        $.ajax({
            type: 'POST',
            url: '/request/approve/{{school_id}}',
            data: {
                csrfmiddlewaretoken: csrf_token,
            },
            success: function (response) {                
                history.back()
                refresh()
            },
            error: function (error) {
                console.log('error', error)
            }
        })


    })
</script>

{% endblock content %}
